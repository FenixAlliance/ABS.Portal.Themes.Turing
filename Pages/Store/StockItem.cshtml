@inherits FenixAlliance.ABM.Data.Access.Services.Templating.Razor.Templates.DynamicComponentBase
@using System
@using Microsoft.EntityFrameworkCore
@using Newtonsoft.Json
@using System.Linq
@using System.Threading.Tasks
@using System.Collections.Generic
@using System.Security.Claims
@using FenixAlliance.ABM.Data.Interfaces.Services
@using FenixAlliance.ABM.Models.Global.Carts.CartScopes

@{
    var marketplaceDataService = ServiceProvider.GetService(typeof(IMarketplaceDataService)) as IMarketplaceDataService;

    var cart = ViewData["Cart"] as FenixAlliance.ABM.Models.Global.Carts.Cart;

    var product = (FenixAlliance.ABM.Models.Logistics.Stock.Item.Item)Model;

    var IP = Context.Connection.RemoteIpAddress.ToString();

    var ProductImagePlaceholder = "/Store/img/empty-image.png";

    var GoogleQuery = $"\"{product.SKU}\"";

    var URL = "https://" + Context.Request?.Host + Context.Request.Path;

    var relatedProducts = marketplaceDataService.Products.Where(c => c.BusinessID == product.BusinessID).Take(6).ToList();

    ViewBag.Image = ProductImagePlaceholder;

    await InvokeAsync(User, product.ID, IP);
}

<script>
    const ItemID = '@product.ID';
</script>


<div class="app-content">

    <div class="u-s-p-t-90">
        <div class="container">
            <div class="row">
                <div class="col-lg-5">

                    <div class="pd-breadcrumb u-s-m-b-30">
                        <ul class="pd-breadcrumb__list">
                            <li class="has-separator">
                                <a href="/">Home</a>
                            </li>
                            <li class="has-separator">
                                <a href="/Store">Store</a>
                            </li>
                            <li class="has-separator">
                                <a href="/Store/product.">product.</a>
                            </li>
                            <li class="is-marked">
                                <a href="#">@product.SKU</a>
                            </li>
                        </ul>
                    </div>


                    <div class="pd u-s-m-b-30">
                        <div class="slider-fouc pd-wrap">
                            <div id="pd-o-initiate">
                                <div class="pd-o-img-wrap" data-src="@(product.PrimaryImageURL ?? "/Store/img/empty-image.png")">
                                    <img class="u-img-fluid" src="@(product.PrimaryImageURL ?? "/Store/img/empty-image.png")" onerror="this.src='/Store/img/empty-image.png'" data-zoom-image="@product.PrimaryImageURL" alt="">
                                </div>
                                @if (product.ItemImages is not null && product.ItemImages.Count != 0)
                                {
                                    foreach (var item in product.ItemImages)
                                    {
                                        <div class="pd-o-img-wrap" data-src="@product.PrimaryImageURL">
                                            <img src="@(item.FileUploadURL ?? "/Store/img/empty-image.png")" onerror="this.src='/Store/img/empty-image.png'" data-zoom-image="@(item.FileUploadURL ?? "/Store/img/empty-image.png")" alt="">
                                        </div>
                                    }
                                }
                            </div>
                            <span class="pd-text">Click for larger zoom</span>
                        </div>
                        <div class="u-s-m-t-15">
                            <div class="slider-fouc">
                                <div id="pd-o-thumbnail">
                                    <div>
                                        <img class="u-img-fluid" src="@product.PrimaryImageURL" alt="">
                                    </div>
                                    @if (product.ItemImages is not null && product.ItemImages.Count != 0)
                                    {
                                        foreach (var item in product.ItemImages)
                                        {
                                            <div>
                                                <img class="u-img-fluid" src="@(item.FileUploadURL ?? "/Store/img/empty-image.png")" onerror="this.src='/Store/img/empty-image.png'" alt="">
                                            </div>
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                    </div>


                    @if (!String.IsNullOrEmpty(product.ItemCategoryID) && product.ItemCategoryID != "Digital")
                    {
                        <div class="detail-info-entry">
                            <div class="inline-product.entry" style="display: flex;">
                                <i style="color:#007C00" class="fas fa-shipping-fast fa-5x"></i>
                                <div class="content" style="margin-left:50px;">
                                    <div class="cell-view" style="line-height:0px">
                                        <a href="#" class="title" style="margin:0px; line-height: 20px;"><b>@_("Included National Shipping to:")</b></a>
                                        <div class="price" style="letter-spacing:1px; margin:0px; padding:0px; line-height: 15px; ">
                                            <div class="current" style="font-size:15px; letter-spacing:1px; margin:0px; padding:0px; line-height: 20px;">
                                                <img src="@product.ShippingCountry?.CountryFlagUrl" style="max-height:12px;" />&nbsp;  @product.ShippingCountry?.Name, principal cities.
                                            </div>
                                        </div>
                                        <p class="title" style="margin-top:0px;text-decoration:none;font-size:12px;letter-spacing:1px;line-height: 14px;">
                                            <sub style="font-size:10px">@_("Not applicable for large Items.")</sub>
                                            <br />
                                            @_("See shipping policies for this Item.")
                                        </p>
                                    </div>
                                </div>
                                <div class="clear"></div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="detail-info-entry">
                            <div class="inline-product.entry" style="display: flex;">
                                <i style="color:#3483FA" class="fas fa-download fa-5x"></i>
                                <div class="content" style="margin-left:50px;">
                                    <div class="cell-view" style="line-height:0px">
                                        <a href="#" class="title" style="margin:0px; line-height: 20px;"><b>@_("Digital Item"):</b></a>
                                        <div class="price" style="letter-spacing:1px; margin:0px; padding:0px; line-height: 15px; ">
                                            <div class="current" style="font-size:15px; letter-spacing:1px; margin:0px; padding:0px; line-height: 20px;">
                                                @_("Digital Download Delivery Service.")
                                            </div>
                                        </div>
                                        <p class="title" style="margin-top:0px;text-decoration:none;font-size:12px;letter-spacing:1px;line-height: 14px;">
                                            <sub>@_("Not applicable for physical Items.") </sub>
                                            <br />
                                            @_("See shipping policies for this Item.")
                                        </p>
                                    </div>
                                </div>
                                <div class="clear"></div>
                            </div>
                        </div>
                    }
                </div>

                <div class="col-lg-4">

                    <div class="pd-detail">
                        <div>
                            <span class="pd-detail__name">@product.Title</span>
                        </div>
                        <div>
                            <div class="pd-detail__inline">
                                <span class="pd-detail__price">
                                    @if (product.OnDiscount)
                                    {
                                        <span class="prev">
                                            @await Component.InvokeAsync("ItemPrice", new { Item = Model, DisplayDiscountPrice = false, PrintUnformatted = false, ForexRates = ViewData["ExchangeRates"] })
                                        </span>

                                        <span class="current" style="color:seagreen !important; font-weight:400;">@await Component.InvokeAsync("ItemPrice", new { Item = Model, DisplayDiscountPrice = true, PrintUnformatted = false })</span>
                                    }
                                    else
                                    {
                                        <span class="current" style="color:seagreen !important; font-weight:400;">@await Component.InvokeAsync("ItemPrice", new { Item = Model, DisplayDiscountPrice = false, PrintUnformatted = false, ForexRates = ViewData["ExchangeRates"] })</span>
                                    }
                                </span>
                            </div>
                        </div>

                        <div class="u-s-m-b-15">
                            @Html.Raw(await ViewService.RenderAsync("StoreItemRating", Model))
                        </div>

                        <div class="u-s-m-b-15">
                            <div class="pd-detail__inline">
                                @if (product.CurrentStock > 0)
                                {
                                    @if (product.CurrentStock < 5)
                                    {

                                        <span class="pd-detail__left">Only @product.CurrentStock left</span>
                                    }
                                    else
                                    {
                                        <span class="pd-detail__stock">@product.CurrentStock in stock</span>
                                    }
                                }
                            </div>
                        </div>
                        <div class="u-s-m-b-15">
                            <span class="pd-detail__preview-desc">
                                @product.ShortDescription
                            </span>
                        </div>

                        @if (User.Identity.IsAuthenticated)
                        {
                            @if (product.InStock || product.ByRequest)
                            {
                                @await ViewService.RenderAsync("ExpressCheckoutButton", Model)
                            }
                            else
                            {
                                <div class="alert alert-danger">
                                    <b>@_("Express checkout is disabled for Out of Stock Items.")</b><br />
                                    @_("You can add it to a WishList and we will send you an email when this Item's state changes.")
                                </div>
                            }
                        }
                        else
                        {
                            @if (product.InStock || product.ByRequest)
                            {
                                <a class="button style-4" style="display:block; border-radius: 5px;" href="/account/login">@_("Login to checkout")</a>
                            }
                        }

                        @if (!product.InStock && !product.ByRequest)
                        {
                            <div class="alert alert-danger">
                                <b>@_("Cart checkout is disabled for Out of Stock Items that cannot currently be requested.")</b><br />
                                @_("You can add it to a WishList and we will send you an email when this Item's state change.")
                            </div>
                        }
                        else
                        {
                            <hr />

                            <div class="u-s-m-b-15">
                                <div class="pd-detail__form">
                                    <div class="pd-detail-inline-2">
                                        @if (DataContext.ItemCartRecord.Any(c => c.ItemID == product.ID && c.CartID == cart.ID))
                                        {
                                            <div class="u-s-m-b-15">
                                                <button id="CartButton" class="btn btn--e-brand-b-2" onclick="RemoveStockItemFromCart('@DataContext.ItemCartRecord.FirstOrDefault(c => c.ItemID == product.ID && c.CartID == cart.ID)?.ID')" type="submit">Remove from cart</button>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="u-s-m-b-15">

                                                <div class="input-counter">
                                                    <span class="input-counter__minus fas fa-minus"></span>
                                                    <input class="input-counter__text input-counter--text-primary-style" id="CartQuantity" type="text" value="1" data-min="1" data-max="1000">
                                                    <span class="input-counter__plus fas fa-plus"></span>
                                                </div>

                                            </div>

                                            <div class="u-s-m-b-15">
                                                <button id="CartButton" class="btn btn--e-brand-b-2" onclick="AddStockItemToCart('@product.ID', parseInt($('#CartQuantity').val()))">Add to Cart</button>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>

                        }


                        <div class="u-s-m-b-15">
                            <div class="pd-detail__inline">
                                <span class="pd-detail__click-wrap">
                                    <i class="fas fa-heart u-s-m-r-6"></i>
                                    <a onclick="AddProductToWishlist('@product.ID')">Add to Wishlist</a>
                                    <span class="pd-detail__click-count">
                                        (@DataContext.ItemWishListRecord.AsNoTracking().Where(c => c.ItemID == product.ID).Count())
                                    </span>
                                </span>
                            </div>
                        </div>

                        <div class="u-s-m-b-15">
                            <div class="pd-detail__inline">
                                <span class="pd-detail__click-wrap">
                                    <i class="fas fa-less-than-equal u-s-m-r-6"></i>
                                    <a onclick="AddProductToCompare('@product.ID')">@_("Add to compare table")</a>
                                    <span class="pd-detail__click-count">
                                        (@DataContext.ItemToCompareRecord.AsNoTracking().Where(c => c.ItemID == product.ID).Count())
                                    </span>
                                </span>
                            </div>
                        </div>

                        <div class="u-s-m-b-15">
                            <span class="pd-detail__label u-s-m-b-8">product.Policy:</span>
                            <ul class="pd-detail__policy-list">
                                <li>
                                    <i class="fas fa-check-circle u-s-m-r-8"></i>
                                    <span>Buyer Protection.</span>
                                </li>
                                <li>
                                    <i class="fas fa-check-circle u-s-m-r-8"></i>
                                    <span>Full Refund if you don't receive your order.</span>
                                </li>
                                <li>
                                    <i class="fas fa-check-circle u-s-m-r-8"></i>
                                    <span>Returns accepted if product.not as described.</span>
                                </li>
                            </ul>
                        </div>

                    </div>

                </div>
                <div class="col-lg-3 information-entry product.sidebar">
                    <div class="card">
                        <div class="card-body">
                            @if (product.Brand != null)
                            {
                                <div class="col-md-12  information-entry  text-center">
                                    <div class="Item-column-entry detail-info-lines border-box">
                                        <div class="image">
                                            <a href="Store/Brands/Details/@product.Brand.ID">
                                                <img src="@product.Brand?.LogoURL" alt="@product.Brand.Name's Logo">
                                            </a>
                                        </div>
                                        <h3 class="title text-center"><a href="/Store/Brands/Details/@product.Brand.ID">@product.Brand.Name</a></h3>
                                        <div class="description">
                                            <a target="_blank" href="@product.Brand.WebsiteURL">@_("Brand Website")</a>
                                        </div>
                                    </div>
                                </div>
                            }
                            <div class="col-md-12  information-entry   text-center">
                                <div class="information-blocks">
                                    <div class="detail-info-lines border-box text-center">
                                        <div class="share-box" style="display: grid;">
                                            <h3 class="title  text-center">
                                                <b>@_("Item SKU"):</b>
                                                <br />
                                                <a href="https://www.google.com/search?q=@product.SKU" target="_blank" data-toggle="tooltip" data-placement="top" title="Click to Search with Google"><b>@product.SKU</b></a>
                                            </h3>
                                        </div>
                                        <div class="share-box" style="display: grid;">
                                            <h3 class="title">
                                                <b>@_("Merchant Profile"):</b>
                                                <br />
                                                <b>
                                                    @product.Business?.BusinessName
                                                    <br />
                                                    <a href="/Studio/Social/Businesses/@product.Business?.ID">
                                                        @_("By"): @product.Business?.BusinessLegalName
                                                    </a>
                                                    <br />
                                                    <a href="/Studio/Social/Businesses/@product.Business?.ID">
                                                        @_("Tax ID"): @product.Business?.TaxID
                                                    </a>
                                                </b>
                                            </h3>
                                        </div>

                                        @if (product.ItemCategory != null)
                                        {
                                            <div class="share-box" style="display: grid;">
                                                <h3 class="title  text-center">
                                                    <b>@_("Primary Category"):</b>
                                                    <br />
                                                    <b>
                                                        <a href="Store/Categories/Details/@product.ItemCategoryID">@Model?.ItemCategory?.Title</a>
                                                    </b>
                                                </h3>
                                            </div>
                                        }

                                        @if (product.ItemType != null)
                                        {
                                            <div class="share-box" style="display: grid;">
                                                <h3 class="title"><b>@_("Item Type"): <br /><a href="Store/Types/Details/@product.ItemTypeID">@product.ItemType.SingularTitle</a></b></h3>
                                            </div>
                                        }

                                        @if (product.ItemTaxPolicyRecords != null && product.ItemTaxPolicyRecords.Count != 0)
                                        {
                                            <div class="share-box" style="display: grid;">
                                                <h3 class="title"><b>@_("Applied Taxes")</b></h3>
                                            </div>
                                            @foreach (var item in product.ItemTaxPolicyRecords)
                                            {
                                                <div class="share-box" style="display: grid;">
                                                    <h3 class="title"><b></b>@item.TaxPolicy?.Title</h3>
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            <div class="share-box" style="display: grid;">
                                                <h3 class="title"><b></b>Empty</h3>
                                            </div>
                                        }


                                        @if (product.ItemTagRecords != null && product.ItemTagRecords.Count != 0)
                                        {
                                            <div class="share-box" style="display: grid;">
                                                <h3 class="block-title inline-Item-column-title">@_("Item Tags")</h3>
                                            </div>

                                            @foreach (var Tag in product.ItemTagRecords)
                                            {
                                                <div class="share-box" style="display: grid;">
                                                    <a href="Store/Tags/Details?id=@Tag.ItemTag.ID">@Tag.ItemTag?.Title</a>
                                                </div>
                                            }
                                        }

                                        <div class="u-s-m-b-15">

                                            <h3 style="font-weight:600" class="Item-title">@_("Like it? Share it!") ðŸ˜ƒ</h3>
                                            <div class="share-box" style="display: grid;">
                                                <div id="share"></div>
                                            </div>

                                            <ul class="pd-social-list text-center">
                                                <li>
                                                    <a class="s-fb--color-hover" href="#">
                                                        <i class="fab fa-facebook-f"></i>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="s-tw--color-hover" href="#">
                                                        <i class="fab fa-twitter"></i>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="s-insta--color-hover" href="#">
                                                        <i class="fab fa-instagram"></i>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="s-wa--color-hover" href="#">
                                                        <i class="fab fa-whatsapp"></i>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="s-linkedin--color-hover" href="#">
                                                        <i class="fab fa-linkedin"></i>
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="u-s-p-y-90">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="pd-tab">
                        <div class="u-s-m-b-30">
                            <ul class="nav pd-tab__list">
                                @if (product.DisplayShowcaseTab)
                                {
                                    <li class="nav-item">
                                        <a class="nav-link active" data-toggle="tab" href="#pd-desc">SHOWCASE</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#pd-specs">SPECIFICATIONS</a>
                                    </li>
                                }
                                else
                                {
                                    <li class="nav-item">
                                        <a class="nav-link active" data-toggle="tab" href="#pd-specs">SPECIFICATIONS</a>
                                    </li>
                                }

                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#pd-policies">POLICIES</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#pd-questions">QUESTIONS</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="view-review" data-toggle="tab" href="#pd-rev">
                                        REVIEWS
                                        <span>(@product.ItemReviews?.Count)</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#pd-attachments">ATTACHMENTS</a>
                                </li>
                            </ul>
                        </div>
                        <div class="tab-content">
                            @if (product.DisplayShowcaseTab)
                            {

                                <div class="tab-pane" id="pd-desc">
                                    <div class="pd-tab__tag">
                                        <h2 class="u-s-m-b-15">product.Attachments</h2>
                                        <div class="u-s-m-b-15">
                                            @Html.Raw(@product.Description)
                                        </div>
                                    </div>
                                </div>

                            }

                            <div class="tab-pane fade show @((!product.DisplayShowcaseTab) ? "active": string.Empty)" id="pd-specs">

                                @if (!string.IsNullOrEmpty(product.ShortDescription))
                                {

                                    <div class="u-s-m-b-15">
                                        <p>@Html.Raw(product.ShortDescription ?? "Empty Description")</p>
                                    </div>
                                }

                                @if (!string.IsNullOrEmpty(product.YoutubeVideoID))
                                {
                                    <div class="u-s-m-b-30"><iframe src="https://www.youtube.com/embed/@product.YoutubeVideoID" allowfullscreen></iframe></div>
                                }

                                <div class="u-s-m-b-15">
                                    <div class=" table-responsive">
                                        <table class="table">
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <b>
                                                            Summary
                                                        </b>
                                                    </td>

                                                    <td>
                                                        <div class="comment">
                                                            <div class="comment-content">
                                                                <div class="comment-title"><span>@product.Title</span></div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td>
                                                        <b>
                                                            Reviews
                                                        </b>
                                                    </td>

                                                    <td>
                                                        @Html.Raw(await ViewService.RenderAsync("StoreItemRating", Model))
                                                    </td>
                                                </tr>

                                                @if (!String.IsNullOrEmpty(product.ShortDescription))
                                                {
                                                    <tr>
                                                        <td><b>@_("Description")</b></td>
                                                        <td>
                                                            <div class="article-container style-1">
                                                                <p>@Html.Raw(product.ShortDescription)</p>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                }

                                                @if (!String.IsNullOrEmpty(product.SKU))
                                                {
                                                    <tr>
                                                        <td><b>@_("Item SKU"):</b></td>
                                                        <td>@product.SKU</td>
                                                    </tr>
                                                }

                                                @if (product.ItemType != null)
                                                {
                                                    <tr>
                                                        <td><b>@_("Item Type"):</b></td>
                                                        <td>
                                                            @product.ItemType.SingularTitle
                                                        </td>
                                                    </tr>
                                                }

                                                @if (product.Brand != null)
                                                {
                                                    <tr>
                                                        <td><b>@_("Manufacturer"):</b></td>
                                                        <td>
                                                            @product.Brand.Name
                                                        </td>
                                                    </tr>
                                                }

                                                @if (!String.IsNullOrEmpty(product.Series))
                                                {
                                                    <tr>
                                                        <td><b>@_("Item Series"):</b></td>
                                                        <td>
                                                            @product.Series
                                                        </td>
                                                    </tr>
                                                }

                                                @if (product.ItemCategoryRecords != null && product.ItemCategoryRecords.Count != 0)
                                                {
                                                    <tr>
                                                        <td><b>@_("Categories")</b></td>
                                                        <td>
                                                            @foreach (var cat in product.ItemCategoryRecords)
                                                            {
                                                                <span class="badge badge-success">@cat.ItemCategory.Title</span>
                                                            }
                                                        </td>
                                                    </tr>
                                                }

                                                @if (product.ItemAttributeOptionRecords != null && product.ItemAttributeOptionRecords.Count != 0)
                                                {
                                                    @foreach (var Attrib in product.ItemAttributeOptionRecords)
                                                    {
                                                        <tr>
                                                            <td><b>@Attrib.AttributeOption.ItemAttribute.Name</b></td>
                                                            <td>
                                                                <div class="tags-box">
                                                                    <a href="Store/AttributeOptions/Details/@Attrib.AttributeOptionID">@Attrib.AttributeOption.Name</a>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    }
                                                }

                                                @if (product.ItemCategoryRecords != null && product.ItemCategoryRecords.Count != 0)
                                                {
                                                    <tr>
                                                        <td><b>@_("Tags"):</b></td>
                                                        <td>
                                                            @foreach (var cat in product.ItemTagRecords)
                                                            {
                                                                <span class="badge badge-primary">@cat.ItemTag.Title</span>
                                                            }
                                                        </td>
                                                    </tr>
                                                }

                                                @if (product.ShippingCountry != null)
                                                {
                                                    <tr>
                                                        <td><b>@_("Shipping Country"):</b></td>
                                                        <td>
                                                            <div class="comment">
                                                                <a class="comment-image" href="#"><img src="@product.ShippingCountry.CountryFlagUrl" style="max-height: 20px;" alt=""></a>
                                                                <div class="comment-content">
                                                                    <div class="comment-title"><span> @product.ShippingCountry.Name</span></div>
                                                                    <div class="comment-text"><span>@product.ShippingCountry.Region</span></div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                }

                                                @if (!String.IsNullOrEmpty(product.SystemRequirements))
                                                {
                                                    <tr>
                                                        <td><b>@_("System requirements"):</b></td>
                                                        <td>
                                                            @product.SystemRequirements?.ToUpper()
                                                        </td>
                                                    </tr>
                                                }
                                                <tr>
                                                    <td><b>@_("Taxable"):</b></td>
                                                    <td>
                                                        @_(product.Taxable.ToString())
                                                    </td>
                                                </tr>
                                                @if (product.PreSale)
                                                {
                                                    <tr>
                                                        <td><b>@_("On Pre-Sale"):</b></td>
                                                        <td>
                                                            @product.PreSale
                                                        </td>
                                                    </tr>
                                                }
                                                @if (!String.IsNullOrEmpty(product.OperatingSystemSupported))
                                                {
                                                    <tr>
                                                        <td><b>@_("Operating System"):</b></td>
                                                        <td>
                                                            @product.OperatingSystemSupported?.ToUpper()
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>


                            <div class="tab-pane fade show" id="pd-policies">
                                @if (product.ItemTaxPolicyRecords != null)
                                {
                                    <div class="col-md-12 information-entry" style="margin-top:15px">
                                        <h3>@_("TAX POLICIES")</h3>
                                        @if (product.ItemTaxPolicyRecords.Count() == 0)
                                        {

                                            <div class="alert alert-danger" role="alert">  <h4>@_("This Item don't have any tax Policies.")</h4></div>
                                        }
                                        else
                                        {
                                            @foreach (var item in product.ItemTaxPolicyRecords)
                                            {
                                                <h4>@Html.Raw(item.TaxPolicy?.Title ?? "")</h4>
                                            }
                                        }
                                    </div>
                                }

                                @if (product.ItemShippingPolicyRecords != null)
                                {
                                    <div class="col-md-12 information-entry" style="margin-top:15px">
                                        <h3>@_("SHIPPING POLICIES")</h3>
                                        @if (product.ItemShippingPolicyRecords.Count() == 0)
                                        {
                                            <div class="alert alert-danger" role="alert">  <h4>@_("This Item don't have any Shipping Policies.")</h4></div>
                                        }
                                        else
                                        {
                                            @foreach (var item in product.ItemShippingPolicyRecords)
                                            {
                                                <h4>@Html.Raw(item.ItemShippingPolicy?.Title ?? "")</h4>
                                                <h6>@Html.Raw(item.ItemShippingPolicy?.Description ?? "")</h6>
                                                <p>@Html.Raw(item.ItemShippingPolicy?.Description ?? "")</p>
                                            }
                                        }
                                    </div>
                                }

                                @if (product.ItemWarrantyPolicyRecords != null)
                                {
                                    <div class="col-md-12 information-entry" style="margin-top:15px">
                                        <h3>@_("Warranty Policies")</h3>

                                        @if (product.ItemWarrantyPolicyRecords.Count() == 0)
                                        {
                                            <div class="alert alert-danger" role="alert">
                                                <h4>@_("This Item don't have any Warranty Policies.")</h4>
                                            </div>
                                        }
                                        else
                                        {
                                            @foreach (var item in product.ItemWarrantyPolicyRecords)
                                            {
                                                <h4>@Html.Raw(item.WarrantyPolicy?.Title ?? "")</h4>
                                                <h6>@Html.Raw(item.WarrantyPolicy?.Description ?? "")</h6>
                                                <p>@Html.Raw(item.WarrantyPolicy?.Description ?? "")</p>
                                            }
                                        }
                                    </div>
                                }

                                @if (product.ItemRefundPolicyRecords != null)
                                {
                                    <div class="col-md-12 information-entry" style="margin-top:15px">
                                        <h3>@_("Refund Policies")</h3>
                                        @if (product.ItemRefundPolicyRecords.Count() == 0)
                                        {
                                            <div class="alert alert-danger" role="alert">
                                                <h4>@_("This Item don't have any Refund Policies.")</h4>
                                            </div>
                                        }
                                        else
                                        {
                                            @foreach (var item in product.ItemRefundPolicyRecords)
                                            {
                                                <h4>@Html.Raw(item.RefundPolicy?.Title ?? "")</h4>
                                                <h6>@Html.Raw(item.RefundPolicy?.Description ?? "")</h6>
                                                <p>@Html.Raw(item.RefundPolicy?.Description ?? "")</p>
                                            }
                                        }
                                    </div>
                                }

                                @if (product.ItemReturnPolicyRecords != null)
                                {
                                    <div class="col-md-12 information-entry" style="margin-top:15px">
                                        <h3>@_("RETURN POLICIES")</h3>
                                        @if (product.ItemReturnPolicyRecords.Count() == 0)
                                        {
                                            <div class="alert alert-danger" role="alert">
                                                <h4>@_("This Item don't have any Return Policies.")</h4>
                                            </div>
                                        }
                                        else
                                        {
                                            @foreach (var item in product.ItemReturnPolicyRecords)
                                            {
                                                <h4>@Html.Raw(item.ReturnPolicy?.Title ?? "")</h4>
                                                <h6>@Html.Raw(item.ReturnPolicy?.Description ?? "")</h6>
                                                <p>@Html.Raw(item.ReturnPolicy?.Description ?? "")</p>
                                            }
                                        }
                                    </div>
                                }
                            </div>


                            <div class="tab-pane" id="pd-questions">
                                <div class="pd-tab__tag">
                                    <h2 class="u-s-m-b-15">ASK YOUR QUESTIONS</h2>
                                    <div class="u-s-m-b-15">

                                        @if (product.ItemQuestions.Count() == 0)
                                        {
                                            <div class="alert alert-danger" role="alert">
                                                <b> @_("This Item don't have any Questions.")</b>
                                            </div>
                                        }
                                        else
                                        {
                                            @foreach (var item in product.ItemQuestions ?? new())
                                            {
                                                if (item.SocialProfile is FenixAlliance.ABM.Models.Social.SocialProfiles.Scopes.AccountHolderSocialProfile)
                                                {
                                                    var SP = item.SocialProfile as FenixAlliance.ABM.Models.Social.SocialProfiles.Scopes.AccountHolderSocialProfile;

                                                    <div class="comment">
                                                        <a class="comment-image" style="max-height:40px" href="#"><img src="@SP.AccountHolder.AvatarURL" alt=""></a>
                                                        <div class="comment-content">
                                                            <div class="comment-title"><span>@_("User Question")</span></div>
                                                            <div class="comment-text">@item.Question</div>
                                                        </div>
                                                    </div>
                                                }
                                            }
                                        }

                                        @if (User.Identity.IsAuthenticated)
                                        {
                                            <form>
                                                <input class="input-text input-text--primary-style" type="text">
                                                <button class="btn btn--e-brand-b-2" type="submit">ASK QUESTION</button>
                                            </form>
                                        }
                                        else
                                        {
                                            <div class="alert alert-danger" role="alert">
                                                <h4>@_("You need to") <a href="/Account/Login" style="text-decoration: underline;"><sub>@_("log In or sign up")</sub></a> @_("into your Alliance ID Account to post a question about")" @product.Title</h4>
                                            </div>
                                        }

                                    </div>
                                </div>
                            </div>


                            <div class="tab-pane" id="pd-rev">
                                <div class="pd-tab__rev">
                                    <div class="u-s-m-b-30">
                                        <div class="pd-tab__rev-score">
                                            <div class="u-s-m-b-8">
                                                <h2>@product.ReviewsCount Reviews - @product.RatingAverage (Overall)</h2>
                                            </div>
                                            <div class="gl-rating-style-2 u-s-m-b-8">

                                                <i class="fas fa-star">

                                                </i><i class="fas fa-star">

                                                </i><i class="fas fa-star">

                                                </i><i class="fas fa-star">

                                                </i><i class="fas fa-star-half-alt"></i>

                                            </div>
                                            <div class="u-s-m-b-8">
                                                <h4>We want to hear from you!</h4>
                                            </div>
                                            <span class="gl-text">Tell us what you think about this item</span>
                                        </div>
                                    </div>

                                    <div class="u-s-m-b-30">
                                        <form class="pd-tab__rev-f1">
                                            <div class="rev-f1__group">
                                                <div class="u-s-m-b-15">
                                                    <h2>@product.ReviewsCount Review(s) for Man Ruched Floral Applique Tee</h2>
                                                </div>
                                                <div class="u-s-m-b-15">
                                                    <label for="sort-review"></label>
                                                    <select class="select-box select-box--primary-style" id="sort-review">
                                                        <option selected>Sort by: Best Rating</option>
                                                        <option>Sort by: Worst Rating</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="rev-f1__review">


                                                <div class="review-o u-s-m-b-15">
                                                    <div class="review-o__info u-s-m-b-8">
                                                        <span class="review-o__name">John Doe</span>
                                                        <span class="review-o__date">27 Feb 2018 10:57:43</span>
                                                    </div>
                                                    <div class="review-o__rating gl-rating-style u-s-m-b-8">
                                                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i>
                                                        <span>(4)</span>
                                                    </div>
                                                    <p class="review-o__text">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
                                                </div>

                                            </div>
                                        </form>
                                    </div>
                                    <div class="u-s-m-b-30">

                                        @if (User.Identity.IsAuthenticated)
                                        {
                                            <form class="pd-tab__rev-f2">
                                                <h2 class="u-s-m-b-15">Add a Review</h2>
                                                <span class="gl-text u-s-m-b-15">Your email address will not be published. Required fields are marked *</span>
                                                <div class="u-s-m-b-30">
                                                    <div class="rev-f2__table-wrap gl-scroll">
                                                        <table class="rev-f2__table">
                                                            <thead>
                                                                <tr>
                                                                    <th>
                                                                        <div class="gl-rating-style-2">
                                                                            <i class="fas fa-star"></i>
                                                                            <span>(1)</span>
                                                                        </div>
                                                                    </th>
                                                                    <th>
                                                                        <div class="gl-rating-style-2">
                                                                            <i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                                                                            <span>(1.5)</span>
                                                                        </div>
                                                                    </th>
                                                                    <th>
                                                                        <div class="gl-rating-style-2">
                                                                            <i class="fas fa-star"></i><i class="fas fa-star"></i>
                                                                            <span>(2)</span>
                                                                        </div>
                                                                    </th>
                                                                    <th>
                                                                        <div class="gl-rating-style-2">
                                                                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                                                                            <span>(2.5)</span>
                                                                        </div>
                                                                    </th>
                                                                    <th>
                                                                        <div class="gl-rating-style-2">
                                                                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                                                            <span>(3)</span>
                                                                        </div>
                                                                    </th>
                                                                    <th>
                                                                        <div class="gl-rating-style-2">
                                                                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                                                                            <span>(3.5)</span>
                                                                        </div>
                                                                    </th>
                                                                    <th>
                                                                        <div class="gl-rating-style-2">
                                                                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                                                            <span>(4)</span>
                                                                        </div>
                                                                    </th>
                                                                    <th>
                                                                        <div class="gl-rating-style-2">
                                                                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                                                                            <span>(4.5)</span>
                                                                        </div>
                                                                    </th>
                                                                    <th>
                                                                        <div class="gl-rating-style-2">
                                                                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                                                            <span>(5)</span>
                                                                        </div>
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td>

                                                                        <div class="radio-box">
                                                                            <input type="radio" id="star-1" name="rating">
                                                                            <div class="radio-box__state radio-box__state--primary">
                                                                                <label class="radio-box__label" for="star-1"></label>
                                                                            </div>
                                                                        </div>

                                                                    </td>
                                                                    <td>

                                                                        <div class="radio-box">
                                                                            <input type="radio" id="star-1.5" name="rating">
                                                                            <div class="radio-box__state radio-box__state--primary">
                                                                                <label class="radio-box__label" for="star-1.5"></label>
                                                                            </div>
                                                                        </div>

                                                                    </td>
                                                                    <td>

                                                                        <div class="radio-box">
                                                                            <input type="radio" id="star-2" name="rating">
                                                                            <div class="radio-box__state radio-box__state--primary">
                                                                                <label class="radio-box__label" for="star-2"></label>
                                                                            </div>
                                                                        </div>

                                                                    </td>
                                                                    <td>

                                                                        <div class="radio-box">
                                                                            <input type="radio" id="star-2.5" name="rating">
                                                                            <div class="radio-box__state radio-box__state--primary">
                                                                                <label class="radio-box__label" for="star-2.5"></label>
                                                                            </div>
                                                                        </div>

                                                                    </td>
                                                                    <td>

                                                                        <div class="radio-box">
                                                                            <input type="radio" id="star-3" name="rating">
                                                                            <div class="radio-box__state radio-box__state--primary">
                                                                                <label class="radio-box__label" for="star-3"></label>
                                                                            </div>
                                                                        </div>

                                                                    </td>
                                                                    <td>

                                                                        <div class="radio-box">
                                                                            <input type="radio" id="star-3.5" name="rating">
                                                                            <div class="radio-box__state radio-box__state--primary">
                                                                                <label class="radio-box__label" for="star-3.5"></label>
                                                                            </div>
                                                                        </div>

                                                                    </td>
                                                                    <td>

                                                                        <div class="radio-box">
                                                                            <input type="radio" id="star-4" name="rating">
                                                                            <div class="radio-box__state radio-box__state--primary">
                                                                                <label class="radio-box__label" for="star-4"></label>
                                                                            </div>
                                                                        </div>

                                                                    </td>
                                                                    <td>

                                                                        <div class="radio-box">
                                                                            <input type="radio" id="star-4.5" name="rating">
                                                                            <div class="radio-box__state radio-box__state--primary">
                                                                                <label class="radio-box__label" for="star-4.5"></label>
                                                                            </div>
                                                                        </div>

                                                                    </td>
                                                                    <td>

                                                                        <div class="radio-box">
                                                                            <input type="radio" id="star-5" name="rating">
                                                                            <div class="radio-box__state radio-box__state--primary">
                                                                                <label class="radio-box__label" for="star-5"></label>
                                                                            </div>
                                                                        </div>

                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="rev-f2__group">
                                                    <div class="u-s-m-b-15">
                                                        <label class="gl-label" for="reviewer-text">YOUR REVIEW *</label><textarea class="text-area text-area--primary-style" id="reviewer-text"></textarea>
                                                    </div>
                                                    <div>
                                                        <p class="u-s-m-b-30">
                                                            <label class="gl-label" for="reviewer-name">NAME *</label>
                                                            <input class="input-text input-text--primary-style" type="text" id="reviewer-name">
                                                        </p>
                                                        <p class="u-s-m-b-30">
                                                            <label class="gl-label" for="reviewer-email">EMAIL *</label>
                                                            <input class="input-text input-text--primary-style" type="text" id="reviewer-email">
                                                        </p>
                                                    </div>
                                                </div>
                                                <div>
                                                    <button class="btn btn--e-brand-shadow" type="submit">SUBMIT</button>
                                                </div>
                                            </form>
                                        }
                                    </div>
                                </div>
                            </div>


                            <div class="tab-pane" id="pd-attachments">
                                <div class="pd-tab__tag">
                                    <h2 class="u-s-m-b-15">product.Attachments</h2>
                                    <div class="u-s-m-b-15">
                                        @if (product.ItemAttachments != null)
                                        {
                                            @if (product.ItemAttachments.Count() == 0)
                                            {
                                                <div class="alert alert-danger" role="alert">
                                                    <h4>@_("This Item don't have any attachments.")</h4>
                                                </div>
                                            }
                                            else
                                            {
                                                @foreach (var item in product.ItemAttachments)
                                                {
                                                    <br />

                                                    <a href="@item.FileUploadURL">
                                                        <div class="information-entry col-md-12">
                                                            <div class="sale-entry">
                                                                <div class="sale-price">
                                                                    <span><i class="fas fa-cloud-download"></i></span>
                                                                    @_("this attachment")
                                                                </div>
                                                                <div class="sale-description">
                                                                    @_("This file contains extended information about"):
                                                                    <b>@product.Title</b>.
                                                                    @_("It may be provided by Fenix Alliance Group, the manufacturer or external sources. We make sure this file is totally free from Malware and that bad stuff. Guaranteed.")
                                                                    <br />
                                                                    <b>@_("File Type"): @item.FileName.Split('.')[1] </b> |
                                                                    <b>@_("File Name"): @item.FileName</b>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </a>

                                                    <hr />
                                                    <br />
                                                    <br />

                                                    <embed src="@item.FileUploadURL" style="margin-top:15px;min-width:100%; min-height:1200px" />

                                                }
                                            }
                                        }
                                        else
                                        {
                                            <h5>@_("No Item Attachments")</h5>
                                        }
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="u-s-p-b-90">

        <div class="section__intro u-s-m-b-46">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="section__text-wrap">
                            <h1 class="section__heading u-c-secondary u-s-m-b-12">CUSTOMER ALSO VIEWED</h1>
                            <span class="section__span u-c-grey">product. THAT CUSTOMER VIEWED</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @await ViewService.RenderAsync("StoreItemsSlider", relatedProducts)
    </div>

</div>



<script type="application/ld+json">
    {
        "@@context": "https://schema.org/",
        "@@type": "Item",
        "name": "@product.Title",
        "image": "@ProductImagePlaceholder",
        "description": "@product.Description",
        "category": "@(product.ItemCategory?.Title ?? "Undefined"),
        "sku": "@product.SKU",
        "mpn": "@(product.MPN ?? product.SKU)",
        "ProductID": "@product.ID",
        "brand": "@(product.Brand?.Name ?? "Undefined")",
        "review": {
            "@@type": "Review",
            "reviewRating": {
                "@@type": "Review",
                "ratingValue": "@product.RatingAverage",
                "bestRating": "@product.MinRating",
                "worstRating": "@product.MaxRating"
            },
            "aggregateRating": {
                "@@type": "AggregateRating",
                "ratingValue": "@product.RatingAverage",
                "reviewCount": "@product.ReviewsCount"
            },
            "author": {
                "@@type": "Organization",
                "name": "Fenix Alliance S.A.S"
            }
        },
        "offers": [{
                "url": "@URL",
                "@@type": "Offer",
                "price": "@product.EstimatedTotalPriceInUSD",
                "priceValidUntil": "2019-06-30",
                "priceCurrency": "USD",
                "itemCondition": "https://schema.org/NewCondition",
                "availability": "https://schema.org/InStock",
                "seller": {
                    "@@type": "Organization",
                    "name": "Fenix Alliance S.A.S"
                }
            }
        ]
    }
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css" />
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css" />

<script>

    $(document).ready(function() {
        $("#share").jsSocials({
            showLabel: false,
            shareIn: "popup",
            showCount: false,
            url: "https://fenixalliance.com.co/store/product./details/@product.ID",
            text: "Buy Now your new @product.Title at @Portal?.Options?.Store?.Name | Just: USD @Math.Round(product.EstimatedTotalPriceInUSD).ToString("C2")",
            shares: ["email", "twitter", "facebook", "linkedin", "pinterest", "whatsapp"]
        });
    });

    function SubmitQuestionValidation() {

        var Question = $('#QuestionMsg').val();

        var QuestionData = { "ItemID": ItemID, "ContactID": CurrentTenantGUID, "Question": Question, "NeedsRevision": true };

        $.ajax(
            {
                url: '/api/ItemQuestions',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                headers: {
                    RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken")').val()
                },
                data: JSON.stringify(QuestionData)
            }
        ).done(
            function(QuestionResult) {
                toastr.success('@_("We will reply to your question as soon as possible")', '@_("Asked Suceessfully")');
                location.reload();
            }
        );

        return false;
    }

    $(document).ready(
        $.ajax({
            url: '/api/Items/CreateSARUsageRecord?ItemID=@product.ID&CartID=' + CartID + '&EventType=Click ',
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            headers: {
                RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
            }
        }).success(function() {
            console.log("Sar record was successfull | Infinity Comex  SAR Engine ");
        })
    );

    function _IsMobile() {
        if (window.innerWidth <= 800 || window.innerHeight <= 600) {
            return true;
        } else {
            return false;
        }
    }
</script>


@functions {

    public async Task InvokeAsync(ClaimsPrincipal User, string ItemID, string IP)
    {
        ViewData["ItemID"] = ItemID;
        ViewData["IsIPCart"] = false;
        ViewData["UserCanEdit"] = false;
        ViewData["AlreadyAdded"] = false;
        ViewData["IsBusinessCart"] = false;

        if (User.Identity.IsAuthenticated)
        {
            // Get Current User Information
            var GUID = HolderService.GetCurrentAccountHolderID(User);

            var Holder = await DataContext.AccountHolder
                .AsNoTracking()
                .Include(c => c.AccountHolderCart)
                    .ThenInclude(c => c.ItemCartRecords)
                        .ThenInclude(c => c.Item)
                .Include(c => c.SelectedBusiness)
                    .ThenInclude(c => c.BusinessCart)
                        .ThenInclude(c => c.ItemCartRecords)
                            .ThenInclude(c => c.Item)
                .FirstOrDefaultAsync(m => m.Id == GUID);

            ViewData["EndUser"] = Holder;

            if (Holder.SelectedBusiness != null)
            {
                ViewData["IsBusinessCart"] = true;

                ViewData["UserCanEdit"] = await DataContext.Item.AsNoTracking().AnyAsync(c => c.ID == ItemID && c.BusinessID == Holder.SelectedBusinessID);

                foreach (var item in Holder.SelectedBusiness.BusinessCart.ItemCartRecords)
                {

                    if (item.ItemID == ItemID)
                    {
                        ViewData["AlreadyAdded"] = true;
                        ViewData["RecordID"] = item.ID;
                    }
                }
            }
            else
            {
                foreach (var item in Holder.AccountHolderCart.ItemCartRecords)
                {
                    if (item.ItemID == ItemID)
                    {
                        ViewData["AlreadyAdded"] = true;
                        ViewData["RecordID"] = item.ID;
                    }

                }
            }
        }
        else
        {
            var ViewIPCart = await DataContext.GuestCart.AsNoTracking().Include(c => c.ItemCartRecords).FirstOrDefaultAsync(c => c.IP == IP);

            ViewData["ViewIPCart"] = ViewIPCart;

            ViewData["IsIPCart"] = true;

            foreach (var item in ViewIPCart?.ItemCartRecords ?? new())
            {
                if (item.ItemID == ItemID)
                {
                    ViewData["AlreadyAdded"] = true;
                    ViewData["RecordID"] = item.ID;
                }
            }
        }
    }

    private bool IPCartExist(string IP)
    {
        return DataContext.GuestCart.Any(c => c.IP == IP);
    }
}